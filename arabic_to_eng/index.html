<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Islam &amp; Qur&#x27;an Q&amp;A</title>
  <link rel="stylesheet" href="css/main.css">
</head>

<body class="safe">
  <header>
    <h1>Islam &amp; Qur&#x27;an Q&amp;A</h1>
    <p class="sub">Answer each question. When you finish, you‚Äôll see your choices, the correct answers, and your score.</p>
  </header>

  <div class="wrap">

    <div class="topbar">
      <button class="btn" id="btnBack" title="Main Page">Back</button>
      <span class="pill" id="pillPos">Question 1 / 66</span>
      <span class="pill" id="pillAnswered">Answered: 0 / 66</span>
      <button class="btn" id="btnReset" title="Start over">Reset</button>
    </div>

    <div class="progress" aria-hidden="true">
      <div class="bar" id="bar"></div>
    </div>

    <div class="card" id="quizCard">
      <div class="qhead">
        <p class="q" id="qText">‚Äî</p>
        <div class="qnum" id="qNum">Q‚Äî</div>
      </div>

      <div class="opts" id="opts"></div>

      <div class="helper">
        <span id="hint">Pick one answer, then press Next.</span>
        <span id="saved">Not answered yet.</span>
      </div>

      <div class="nav">
        <button class="btn" id="btnPrev">‚óÄ Previous</button>
        <button class="btn primary" id="btnNext">Next ‚ñ∂</button>
      </div>

      <div class="nav">
        <button class="btn" id="btnCheck">Check this answer</button>
        <button class="btn" id="btnJumpUnanswered" style="display:none;">Go to next unanswered</button>
        <button class="btn good" id="btnFinish">Finish & see results</button>
      </div>
    </div>

    <div class="card results" id="resultsCard" style="margin-top: 12px;">
      <div class="qhead" style="margin-bottom: 0;">
        <p class="q">Results</p>
        <div class="qnum" id="scoreLine">‚Äî</div>
      </div>

      <div class="stats">
        <div class="stat">
          <div class="label">Right ‚úÖ</div>
          <div class="value" id="statRight">0</div>
        </div>
        <div class="stat">
          <div class="label">Wrong ‚ùå</div>
          <div class="value" id="statWrong">0</div>
        </div>
        <div class="stat">
          <div class="label">Answered</div>
          <div class="value" id="statAnswered">0</div>
        </div>
      </div>

      <div class="table" id="resultsTableWrap">
        <table id="resultsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Question</th>
              <th>Your answer</th>
              <th>Correct answer</th>
              <th>Result</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="nav" style="margin-top: 12px;">
        <button class="btn" id="btnBackToQuiz">‚óÄ Back to quiz</button>
        <button class="btn primary" id="btnPrint">Print / Save as PDF</button>
      </div>
    </div>
  </div>

<script>
  const QUIZ = {"title":"Arabic Vocabulary (Arabic ‚Üí English)","version":1,"count":42,"questions":[{"id":1,"question":"ŸÉŸêÿ™Ÿéÿßÿ®Ÿå","options":["An earth","A book","A Boy","A room"],"answer":"A book","answer_index":1},{"id":2,"question":"ŸÖŸéÿ≥Ÿíÿ¨ŸêÿØŸå","options":["A mosque","Market","Beautiful","Sun"],"answer":"A mosque","answer_index":0},{"id":3,"question":"ÿ®ŸéŸäŸíÿ™Ÿå","options":["A sister","A house","old","Moon"],"answer":"A house","answer_index":1},{"id":4,"question":"ŸÇŸéŸÑŸéŸÖŸå","options":["A pen","Bad","Tree","good"],"answer":"A pen","answer_index":0},{"id":5,"question":"ÿ¨Ÿêÿ®ŸéÿßŸÑŸå","options":["A chair","mountains","A garden","fast"],"answer":"mountains","answer_index":1},{"id":6,"question":"ÿ¥Ÿéÿ¨Ÿéÿ±Ÿéÿ©Ÿå","options":["Tree","tall","A table","dirty"],"answer":"Tree","answer_index":0},{"id":7,"question":"ÿßŸêŸÖŸíÿ±Ÿéÿ£Ÿéÿ©Ÿå","options":["Women","A brother","Cold","A student"],"answer":"Women","answer_index":0},{"id":8,"question":"ŸÉŸèÿ±Ÿíÿ≥ŸêŸäŸå","options":["A chair","A mosque","Short","A father"],"answer":"A chair","answer_index":0},{"id":9,"question":"ÿßŸéÿ±Ÿíÿ∂Ÿå","options":["An earth","A girl","Market","new"],"answer":"An earth","answer_index":0},{"id":10,"question":"ÿ®Ÿéÿßÿ®Ÿå","options":["A door","A school","A room","Hot"],"answer":"A door","answer_index":0},{"id":11,"question":"ÿ£ÿÆŸå","options":["A brother","A mother","Beautiful","slow"],"answer":"A brother","answer_index":0},{"id":12,"question":"ÿ£ŸèÿÆŸíÿ™Ÿå","options":["A sister","Sun","A Boy","good"],"answer":"A sister","answer_index":0},{"id":13,"question":"ŸÖŸéÿØŸíÿ±Ÿéÿ≥Ÿéÿ©","options":["A school","A chair","Bad","Moon"],"answer":"A school","answer_index":0},{"id":14,"question":"ÿ∑ŸéÿßŸàŸêŸÑŸéÿ©","options":["A table","A book","Cold","A garden"],"answer":"A table","answer_index":0},{"id":15,"question":"ÿ∑ŸéÿßŸÑŸêÿ®Ÿå","options":["A student","A father","dirty","tall"],"answer":"A student","answer_index":0},{"id":16,"question":"ŸÖŸèÿπŸéŸÑŸêŸëŸÖŸå","options":["A teacher","A brother","mountains","old"],"answer":"A teacher","answer_index":0},{"id":17,"question":"ÿ±Ÿéÿ¨ŸèŸÑŸå","options":["Man","A room","Market","new"],"answer":"Man","answer_index":0},{"id":18,"question":"ÿ∫Ÿèÿ±ŸíŸÅŸéÿ©Ÿå","options":["A room","A house","Sun","Beautiful"],"answer":"A room","answer_index":0},{"id":19,"question":"ÿ¥ŸéŸÖŸíÿ≥Ÿå","options":["Sun","A girl","Hot","Bad"],"answer":"Sun","answer_index":0},{"id":20,"question":"ŸÇŸéŸÖŸéÿ±Ÿå","options":["Moon","Tree","slow","good"],"answer":"Moon","answer_index":0},{"id":21,"question":"ÿ≠ŸéÿØŸêŸäŸÇŸéÿ©","options":["A garden","A chair","Cold","A mosque"],"answer":"A garden","answer_index":0},{"id":22,"question":"ŸàŸéŸÑŸéÿØŸå","options":["A Boy","A student","An earth","fast"],"answer":"A Boy","answer_index":0},{"id":23,"question":"ÿ®ŸêŸÜŸíÿ™Ÿå","options":["A girl","A father","old","Beautiful"],"answer":"A girl","answer_index":0},{"id":24,"question":"ÿ£ŸÖ","options":["A mother","A brother","Market","Hot"],"answer":"A mother","answer_index":0},{"id":25,"question":"ÿ£ÿ®","options":["A father","A house","Tree","Bad"],"answer":"A father","answer_index":0},{"id":26,"question":"ÿ≥ŸèŸàŸÇŸå","options":["Market","A school","A table","slow"],"answer":"Market","answer_index":0},{"id":27,"question":"ŸÜŸéÿ∏ŸêŸäŸÅŸå","options":["clean","Beautiful","new","Cold"],"answer":"clean","answer_index":0},{"id":28,"question":"ŸàŸéÿ≥ŸêÿÆŸå","options":["dirty","A book","A chair","A teacher"],"answer":"dirty","answer_index":0},{"id":29,"question":"ÿ¨ŸéŸÖŸêŸäŸÑŸå","options":["Beautiful","A Boy","Moon","fast"],"answer":"Beautiful","answer_index":0},{"id":30,"question":"ÿ∑ŸéŸàŸêŸäŸÑŸå","options":["tall","A sister","An earth","Hot"],"answer":"tall","answer_index":0},{"id":31,"question":"ŸÇŸéÿµŸêŸäÿ±Ÿå","options":["Short","A mosque","good","A garden"],"answer":"Short","answer_index":0},{"id":32,"question":"ŸÉŸéÿ®ŸêŸäÿ±Ÿå","options":["big","A father","old","Tree"],"answer":"big","answer_index":0},{"id":33,"question":"ÿµŸéÿ∫ŸêŸäÿ±Ÿå","options":["small","A room","Moon","Bad"],"answer":"small","answer_index":0},{"id":34,"question":"ÿπŸéÿ∏ŸêŸäŸÖŸå","options":["Great","A chair","clean","new"],"answer":"Great","answer_index":0},{"id":35,"question":"ÿ≠Ÿéÿßÿ±ŸåŸë","options":["Hot","Market","slow","A brother"],"answer":"Hot","answer_index":0},{"id":36,"question":"ÿ¨ŸéŸäŸêŸëÿØŸå","options":["good","A girl","A house","Cold"],"answer":"good","answer_index":0},{"id":37,"question":"ÿ≥ŸéŸäŸêŸëÿ¶Ÿå","options":["Bad","A teacher","Beautiful","fast"],"answer":"Bad","answer_index":0},{"id":38,"question":"ÿ¨ŸéÿØŸêŸäÿØŸå","options":["new","A mosque","A book","dirty"],"answer":"new","answer_index":0},{"id":39,"question":"ŸÇŸéÿØŸêŸäŸÖŸå","options":["old","A student","Sun","clean"],"answer":"old","answer_index":0},{"id":40,"question":"ÿ≥Ÿéÿ±ŸêŸäÿπŸå","options":["fast","A sister","An earth","A table"],"answer":"fast","answer_index":0},{"id":41,"question":"ÿ®Ÿéÿ∑ŸêŸäÿ°Ÿå","options":["slow","A garden","A Boy","Moon"],"answer":"slow","answer_index":0},{"id":42,"question":"ÿ®Ÿéÿßÿ±ŸêÿØŸå","options":["Cold","Hot","Market","A room"],"answer":"Cold","answer_index":0}]}
  const total = QUIZ.questions.length;

  function shuffleInPlace(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function prepareQuestions(rawQuestions) {
    const qs = rawQuestions.map(q => ({ ...q, options: Array.isArray(q.options) ? [...q.options] : [] }));

    // Randomize question order (each question appears exactly once)
    shuffleInPlace(qs);

    // Randomize options per question, while keeping the correct answer aligned
    qs.forEach(q => {
      if (!Array.isArray(q.options) || q.options.length === 0) return;

      const answerText = (typeof q.answer_index === "number")
        ? q.options[q.answer_index]
        : (q.answer ?? null);

      const indexed = q.options.map(text => ({ text }));
      shuffleInPlace(indexed);
      q.options = indexed.map(x => x.text);

      if (answerText !== null) {
        const newIdx = q.options.findIndex(t => t === answerText);
        q.answer_index = newIdx;
        q.answer = answerText;
      }
    });

    return qs;
  }

  const QUESTIONS = prepareQuestions(QUIZ.questions);

  const els = {
    btnBack: document.getElementById("btnBack"),
    pillPos: document.getElementById("pillPos"),
    pillAnswered: document.getElementById("pillAnswered"),
    bar: document.getElementById("bar"),
    qText: document.getElementById("qText"),
    qNum: document.getElementById("qNum"),
    opts: document.getElementById("opts"),
    hint: document.getElementById("hint"),
    saved: document.getElementById("saved"),
    btnPrev: document.getElementById("btnPrev"),
    btnNext: document.getElementById("btnNext"),
    btnCheck: document.getElementById("btnCheck"),
    btnFinish: document.getElementById("btnFinish"),
    btnReset: document.getElementById("btnReset"),
    btnJumpUnanswered: document.getElementById("btnJumpUnanswered"),
    quizCard: document.getElementById("quizCard"),
    resultsCard: document.getElementById("resultsCard"),
    resultsBody: document.querySelector("#resultsTable tbody"),
    statRight: document.getElementById("statRight"),
    statWrong: document.getElementById("statWrong"),
    statAnswered: document.getElementById("statAnswered"),
    scoreLine: document.getElementById("scoreLine"),
    btnBackToQuiz: document.getElementById("btnBackToQuiz"),
    btnPrint: document.getElementById("btnPrint"),
  };

  // answers[idx] = chosen option index (number) or null
  const answers = Array(total).fill(null);

  let idx = 0;
  let checkedThis = false;

  function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

  function answeredCount() {
    return answers.filter(v => typeof v === "number").length;
  }

  function computeScore() {
    let right = 0, wrong = 0, answered = 0;
    QUESTIONS.forEach((q, i) => {
      const a = answers[i];
      if (typeof a === "number") {
        answered++;
        if (a === q.answer_index) right++;
        else wrong++;
      }
    });
    return { right, wrong, answered };
  }

  function setTop() {
    els.pillPos.textContent = `Question ${idx + 1} / ${total}`;
    els.pillAnswered.textContent = `Answered: ${answeredCount()} / ${total}`;
    els.bar.style.width = `${((idx + 1) / total) * 100}%`;

    els.btnPrev.disabled = idx === 0;
    els.btnNext.disabled = idx === total - 1;

    const score = computeScore();
    const allAnswered = score.answered === total;
    els.btnFinish.textContent = allAnswered ? "Finish & see results" : `Finish (answered ${score.answered}/${total})`;
  }

  function renderQuestion() {
    checkedThis = false;
    const q = QUESTIONS[idx];
    els.qText.textContent = q.question;
    els.qNum.textContent = `Q${q.id}`;

    els.opts.innerHTML = "";
    const name = "q_" + idx;

    const current = answers[idx];

    q.options.forEach((opt, oi) => {
      const label = document.createElement("label");
      label.className = "opt";

      const input = document.createElement("input");
      input.type = "radio";
      input.name = name;
      input.value = String(oi);

      if (current === oi) {
        input.checked = true;
        label.classList.add("selected");
      }

      const span = document.createElement("span");
      span.textContent = opt;

      label.appendChild(input);
      label.appendChild(span);

      label.addEventListener("click", () => {
        // Save answer
        answers[idx] = oi;
        // Visual selected state
        Array.from(els.opts.querySelectorAll(".opt")).forEach(o => o.classList.remove("selected", "correct", "wrong"));
        label.classList.add("selected");

        els.saved.textContent = "Saved ‚úÖ";
        els.hint.textContent = "You can go Next, or press ‚ÄúCheck this answer‚Äù.";
        setTop();
      });

      els.opts.appendChild(label);
    });

    if (typeof current === "number") {
      els.saved.textContent = "Saved ‚úÖ";
      els.hint.textContent = "You can change your answer anytime.";
    } else {
      els.saved.textContent = "Not answered yet.";
      els.hint.textContent = "Pick one answer, then press Next.";
    }

    setTop();
  }

  function checkThis() {
    const q = QUESTIONS[idx];
    const chosen = answers[idx];

    // Clear marks
    const optionEls = Array.from(els.opts.querySelectorAll(".opt"));
    optionEls.forEach(o => o.classList.remove("correct", "wrong"));

    if (typeof q.answer_index === "number") {
      optionEls[q.answer_index]?.classList.add("correct");
    }

    if (typeof chosen === "number") {
      if (typeof q.answer_index === "number" && chosen !== q.answer_index) {
        optionEls[chosen]?.classList.add("wrong");
        els.hint.textContent = "Not quite ‚Äî the correct answer is highlighted ‚úÖ";
      } else {
        els.hint.textContent = "Correct! ‚úÖ";
      }
    } else {
      els.hint.textContent = "Choose an option first üôÇ";
    }

    checkedThis = true;
  }

  function go(n) {
    idx = clamp(n, 0, total - 1);
    renderQuestion();
  }

  function nextUnanswered() {
    for (let i = idx + 1; i < total; i++) {
      if (answers[i] === null) return go(i);
    }
    for (let i = 0; i < total; i++) {
      if (answers[i] === null) return go(i);
    }
    // If none, stay
    els.hint.textContent = "All questions are answered ‚úÖ You can finish now.";
  }

  function showResults() {
    const score = computeScore();
    els.statRight.textContent = String(score.right);
    els.statWrong.textContent = String(score.wrong);
    els.statAnswered.textContent = `${score.answered} / ${total}`;
    els.scoreLine.textContent = `Score: ${score.right} / ${total}`;

    els.resultsBody.innerHTML = "";

    QUESTIONS.forEach((q, i) => {
      const tr = document.createElement("tr");

      const chosenIdx = answers[i];
      const chosenText = (typeof chosenIdx === "number") ? q.options[chosenIdx] : "‚Äî";
      const correctText = (typeof q.answer_index === "number") ? q.options[q.answer_index] : (q.answer ?? "‚Äî");
      const isRight = (typeof chosenIdx === "number" && typeof q.answer_index === "number" && chosenIdx === q.answer_index);

      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${escapeHtml(q.question)}</td>
        <td>${escapeHtml(chosenText)}</td>
        <td>${escapeHtml(correctText)}</td>
        <td>${isRight ? '<span class="tag good">Right ‚úÖ</span>' : (chosenIdx === null ? '<span class="tag bad">Not answered</span>' : '<span class="tag bad">Wrong ‚ùå</span>')}</td>
      `;
      els.resultsBody.appendChild(tr);
    });

    // swap views
    els.quizCard.style.display = "none";
    els.resultsCard.classList.add("show");
    els.resultsCard.style.display = "block";
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function backToQuiz() {
    els.resultsCard.classList.remove("show");
    els.resultsCard.style.display = "none";
    els.quizCard.style.display = "block";
    renderQuestion();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function resetAll() {
    for (let i = 0; i < total; i++) answers[i] = null;
    idx = 0;
    renderQuestion();
    els.hint.textContent = "All cleared. Start again üôÇ";
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // Buttons
  els.btnBack?.addEventListener("click", () => {
    if (window.history.length > 1) {
      window.history.back();
    } else {
      window.location.href = "../index.html";
    }
  });
  els.btnPrev.addEventListener("click", () => go(idx - 1));
  els.btnNext.addEventListener("click", () => go(idx + 1));
  els.btnCheck.addEventListener("click", () => checkThis());
  els.btnJumpUnanswered.addEventListener("click", () => nextUnanswered());
  els.btnFinish.addEventListener("click", () => showResults());
  els.btnBackToQuiz.addEventListener("click", () => backToQuiz());
  els.btnPrint.addEventListener("click", () => window.print());
  els.btnReset.addEventListener("click", () => resetAll());

  // Keyboard support (desktop)
  document.addEventListener("keydown", (e) => {
    if (els.quizCard.style.display === "none") return;
    if (e.key === "ArrowLeft") go(idx - 1);
    if (e.key === "ArrowRight") go(idx + 1);
  });

  // Initial render
  renderQuestion();
</script>
</body>
</html>
