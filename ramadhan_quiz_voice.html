<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ramadhan Quiz</title>
  <style>
    :root{
      --bg0:#050611;
      --bg1:#0b0d24;
      --panel:#0f1330;
      --panel2:#0b0f2a;
      --gold:#d6b36a;
      --gold2:#f0dca2;
      --text:#eef2ff;
      --muted:#b7bfdc;
      --line:rgba(214,179,106,.35);
      --shadow:0 18px 40px rgba(0,0,0,.55);
      --ok:#22c55e;
      --bad:#ef4444;
      --focus:#60a5fa;
      --select:#f59e0b;
    }

    html,body{height:100%;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 50% 20%, rgba(214,179,106,.16), transparent 60%),
        radial-gradient(900px 600px at 50% 100%, rgba(96,165,250,.12), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      overflow:hidden;
    }

    .safe{
      height:100%;
      padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
      box-sizing:border-box;
    }

    .frame{
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      gap:14px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap: 50px;
      padding: 18px 18px 10px;
    }

    .topLeft,.topRight{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}

    .levelTag{
      color: var(--muted);
      font-weight: 900;
      letter-spacing: .04em;
      text-transform: uppercase;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(214,179,106,.25);
      background: rgba(15,19,48,.55);
    }

    .brand{
      display:flex;
      align-items:baseline;
      gap:10px;
      min-width: 0;
    }

    .title{
      font-weight:800;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:var(--gold2);
      font-size: clamp(18px, 2.2vw, 30px);
      white-space:nowrap;
    }

    .subtitle{
      color:var(--muted);
      font-size: clamp(12px, 1.4vw, 16px);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .pills{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
    .pill{
      border: 1px solid var(--line);
      background: rgba(15,19,48,.75);
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
      padding: 14px 18px;
      border-radius: 999px;
      font-weight:900;
      color: var(--gold2);
      font-size: clamp(16px, 2.0vw, 24px);
    }

    .scorePills{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
    .scorePill{
      border: 1px solid var(--line);
      background: rgba(15,19,48,.75);
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
      padding: 14px 18px;
      border-radius: 999px;
      font-weight: 900;
      color: var(--gold2);
      font-size: clamp(16px, 2.0vw, 24px);
      letter-spacing: .02em;
    }

    .voicePill{
      border: 1px solid var(--line);
      background: rgba(15,19,48,.75);
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 900;
      color: var(--muted);
      font-size: 14px;
      letter-spacing: .02em;
      user-select:none;
      white-space:nowrap;
    }

    .levelWrap{
      display:flex;
      align-items:center;
      gap: 12px;
      margin-top: 12px;
    }

    .levelTitle{
      font-weight: 1000;
      letter-spacing: .02em;
      color: var(--gold2);
      font-size: 44px;
      white-space: nowrap;
    }

    .levelRow{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      padding: 0 18px;
      flex-wrap:wrap;
    }

    .levelBtn{
      border: 1px solid var(--line);
      background: rgba(15,19,48,.75);
      box-shadow: 0 8px 20px rgba(0,0,0,.25);
      padding: 12px 16px;
      border-radius: 999px;
      font-weight: 900;
      color: var(--gold2);
      font-size: clamp(14px, 1.8vw, 22px);
      cursor:pointer;
      user-select:none;
      outline:none;
    }

    .levelBtnActive{
      border-color: rgba(96,165,250,.95);
      box-shadow: 0 0 0 3px rgba(96,165,250,.28), 0 12px 28px rgba(0,0,0,.45);
    }

    .stage{
      display:grid;
      grid-template-columns: 1fr;
      align-items:center;
      justify-items:center;
      gap:14px;
      min-height:0;
    }

    .panel{
      width: 100%;
      max-width: 1200px;
      background: linear-gradient(180deg, rgba(15,19,48,.92), rgba(9,12,32,.92));
      border:1px solid var(--line);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 18px;
      box-sizing:border-box;
    }

    .modal{
      width: min(680px, 92vw);
      background: linear-gradient(180deg, rgba(15,19,48,.96), rgba(9,12,32,.96));
      border: 1px solid rgba(214,179,106,.35);
      border-radius: 20px;
      box-shadow: 0 24px 80px rgba(0,0,0,.55);
      padding: 18px;
      box-sizing:border-box;
      animation: pop .12s ease;
      position: relative;
      z-index: 2;
    }

    .fireworks{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 3;
      opacity: 1.95;
      mix-blend-mode: screen;
    }

    .hidden{display:none !important;}

    .concealed{
      visibility: hidden !important;
      pointer-events: none !important;
    }

    .question{
      position: relative;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 16px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(11,15,42,.85), rgba(15,19,48,.85));
      border: 1px solid rgba(214,179,106,.35);
      min-height: 90px;
    }

    .question .levelTag{
      position: absolute;
      top: 12px;
      left: 12px;
      display: none;
    }

    .questionText{
      font-size: clamp(24px, 3.2vw, 52px);
      font-weight: 800;
      line-height: 1.15;
      text-align:center;
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }

    .answers{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .players{
      margin-top: 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 14px;
      flex-wrap:wrap;
    }

    .playerCircle{
      width: 78px;
      height: 78px;
      border-radius: 999px;
      border: 2px solid rgba(214,179,106,.55);
      background: linear-gradient(180deg, rgba(16,22,58,.9), rgba(10,14,40,.9));
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
      display:grid;
      place-items:center;
      cursor:pointer;
      user-select:none;
      position:relative;
      outline:none;
    }

    .playerCircleActive{
      border-color: rgba(96,165,250,.95);
      background: radial-gradient(120px 120px at 30% 25%, rgba(96,165,250,.38), rgba(15,19,48,.55));
      box-shadow: 0 0 0 3px rgba(96,165,250,.28), 0 12px 28px rgba(0,0,0,.45);
    }

    .playerLabel{
      font-weight: 1000;
      font-size: 28px;
      letter-spacing: .04em;
      color: var(--gold2);
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
      line-height: 1;
    }

    .playerPick{
      position:absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      min-width: 30px;
      height: 24px;
      padding: 0 10px;
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 1000;
      letter-spacing: .02em;
      color: var(--bg0);
      background: radial-gradient(circle at 30% 30%, var(--gold2), var(--gold));
      border: 1px solid rgba(0,0,0,.15);
      box-shadow: 0 8px 18px rgba(0,0,0,.35);
      font-size: 14px;
    }

    .ans{
      position:relative;
      border:1px solid rgba(214,179,106,.45);
      background: linear-gradient(180deg, rgba(16,22,58,.9), rgba(10,14,40,.9));
      border-radius: 16px;
      min-height: 72px;
      display:flex;
      align-items:center;
      padding: 10px 14px 10px 16px;
      gap: 12px;
      box-shadow: 0 10px 26px rgba(0,0,0,.35);
      cursor:pointer;
      user-select:none;
      outline:none;
      transition: transform .08s ease, border-color .08s ease, background .12s ease;
    }

    .ans:active{transform: scale(.995);}

    .ans[aria-disabled="true"]{cursor:default; opacity:.98;}

    .ansFocus{
      border-color: rgba(96,165,250,.9);
      box-shadow: 0 0 0 3px rgba(96,165,250,.35), 0 12px 28px rgba(0,0,0,.45);
    }

    .ansSelected{
      border-color: rgba(245,158,11,.95);
      box-shadow: 0 0 0 3px rgba(245,158,11,.28), 0 12px 28px rgba(0,0,0,.45);
    }

    .ansCorrect{
      border-color: rgba(34,197,94,.95);
      background: linear-gradient(180deg, rgba(16,120,60,.28), rgba(10, 40, 19, 0.88));
      box-shadow: 0 0 0 3px rgba(1, 94, 35, 0.28), 0 12px 28px rgba(0,0,0,.45);
    }

    .ansWrong{
      border-color: rgba(239,68,68,.95);
      background: linear-gradient(180deg, rgba(239,68,68,.22), rgba(10,14,40,.85));
      box-shadow: 0 0 0 3px rgba(239,68,68,.26), 0 12px 28px rgba(0,0,0,.45);
    }

    .badge{
      flex:0 0 auto;
      width: 72px !important;
      height: 72px !important;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-weight: 900;
      letter-spacing:.02em;
      color: var(--bg0);
      background: radial-gradient(circle at 30% 30%, var(--gold2), var(--gold));
      box-shadow: 0 10px 24px rgba(0,0,0,.35);
      font-size: 32px !important;
    }

    .ansText{
      flex:1 1 auto;
      font-size: clamp(16px, 2.0vw, 26px);
      font-weight:800;
      line-height: 1.15;
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
    }

    .bottom{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .hint{
      color: var(--muted);
      font-weight: 700;
      font-size: clamp(12px, 1.5vw, 18px);
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .controls{display:flex; gap:10px;}

    .btn{
      border:1px solid rgba(214,179,106,.45);
      background: rgba(15,19,48,.75);
      color: var(--text);
      border-radius: 999px;
      padding: 12px 16px;
      font-weight: 900;
      letter-spacing: .02em;
      font-size: clamp(12px, 1.6vw, 18px);
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.28);
    }

    .btnPrimary{
      background: linear-gradient(180deg, rgba(214,179,106,.25), rgba(15,19,48,.75));
      border-color: rgba(214,179,106,.8);
      color: var(--gold2);
    }

    .btnVoiceActive{
      background: rgba(34,197,94,.95);
      border-color: rgba(34,197,94,1);
      color: rgba(3,15,8,.95);
      box-shadow: 0 0 0 3px rgba(34,197,94,.22), 0 14px 30px rgba(0,0,0,.35);
    }

    .btn:disabled{opacity:.5; cursor:default;}

    .overlay{
      position:fixed;
      inset: 0;
      display:none;
      align-items:center;
      justify-content:center;
      background: rgba(0,0,0,.78);
      padding: 18px;
      box-sizing:border-box;
    }

    .overlay.show{display:flex;}

    .modal{
      width: 100%;
      max-width: 820px;
      background: linear-gradient(180deg, rgba(15,19,48,.96), rgba(9,12,32,.96));
      border:1px solid var(--line);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .modal h2{
      margin: 0;
      font-size: clamp(18px, 2.2vw, 26px);
      color: var(--gold2);
      letter-spacing:.04em;
      text-transform:uppercase;
    }

    .modal p{
      margin: 8px 0 0; 
      color: var(--muted);
      font-weight:700;
      line-height:1.45;
      font-size: clamp(14px, 1.6vw, 18px);
    }

    .modal .row{
      margin-top: 14px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .winnerLine{
      margin: 6px 0 0; 
      font-weight: 1000;
      letter-spacing: .02em;
      color: var(--gold2);
      font-size: clamp(30px, 4.5vw, 64px);
      line-height: 1.05;
      text-align:center;
    }

    .winnerSub{
      margin: 10px 0 0; 
      color: var(--muted);
      font-weight: 800;
      font-size: 20px;
      text-align:center;
    }

    .winnerScores{
      margin-top: 14px;
      display:flex;
      justify-content:center;
      gap: 16px;
      flex-wrap:wrap;
    }
    .winnerScoreCircle{
      width: 86px;
      height: 86px;
      border-radius: 999px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      border: 2px solid rgba(255,255,255,.22);
      background: radial-gradient(120px 120px at 30% 25%, rgba(255,255,255,.12), rgba(0,0,0,.25));
      box-shadow: 0 14px 28px rgba(0,0,0,.35);
    }
    .winnerScoreLabel{font-weight: 1000; font-size: 20px; line-height: 1;}
    .winnerScoreValue{margin-top: 6px; font-weight: 1000; font-size: 28px; line-height: 1; color: var(--gold2);}

    .splash{
      position:fixed;
      inset:0;
      z-index: 80;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 28px;
      overflow:hidden;
      background:
        radial-gradient(1100px 680px at 20% 20%, rgba(255,215,102,.30), transparent 60%),
        radial-gradient(1000px 680px at 80% 70%, rgba(90,168,255,.22), transparent 60%),
        linear-gradient(180deg, rgba(250,250,252,1), rgba(238,242,255,1));
    }
    .splashHidden{display:none;}
    .splashBg{
      position:absolute;
      inset:-40px;
      background:
        radial-gradient(16px 16px at 20% 30%, rgba(255,255,255,.16), transparent 65%),
        radial-gradient(14px 14px at 60% 18%, rgba(255,255,255,.14), transparent 65%),
        radial-gradient(12px 12px at 78% 62%, rgba(255,255,255,.12), transparent 65%),
        radial-gradient(10px 10px at 35% 72%, rgba(255,255,255,.10), transparent 65%),
        radial-gradient(8px 8px at 50% 45%, rgba(255,255,255,.10), transparent 65%);
      filter: blur(.5px);
      opacity: .85;
      transform: translate3d(0,0,0);
      animation: none;
    }
    .splashCard{
      position:relative;
      z-index: 2;
      width: min(920px, 100%);
      padding: 34px 28px;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(10,14,34,.78);
      box-shadow: 0 22px 60px rgba(0,0,0,.45);
      text-align:center;
      backdrop-filter: blur(10px);
    }
    .splashTitle{
      margin: 0;
      font-weight: 1000;
      letter-spacing: .02em;
      color: rgba(255,255,255,.98);
      font-size: clamp(30px, 5.4vw, 72px);
      line-height: 1.05;
      text-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .splashSub{
      margin: 14px 0 0;
      color: rgba(255,255,255,.74);
      font-weight: 800;
      font-size: clamp(16px, 2.2vw, 22px);
      line-height: 1.4;
    }
    .splashActions{margin-top: 22px; display:flex; justify-content:center; gap: 10px; flex-wrap:wrap;}
    .splashStart{font-size: 22px; padding: 12px 18px;}

    .splashRules{
      margin-top: 18px;
      text-align:left;
      color: rgba(255,255,255,.90);
      font-weight: 800;
      font-size: clamp(15px, 1.7vw, 18px);
      line-height: 1.45;
      max-height: none;
      overflow: visible;
      padding-right: 0;
    }
    .splashRulesGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items:start;
    }
    .splashRules h3{
      margin: 16px 0 8px;
      font-size: clamp(18px, 2.2vw, 22px);
      letter-spacing: .01em;
      color: rgba(255,255,255,.98);
    }
    .splashRules .teams{display:grid; grid-template-columns:1fr; gap: 6px;}
    .splashRules ul{margin: 8px 0 0 18px; padding:0;}
    .splashRules li{margin: 6px 0;}
    .splashRulesHidden{display:none;}

    @media (max-width: 980px){
      .splashRulesGrid{grid-template-columns: 1fr;}
    }

    #gameRoot{display:none;}
    #gameRoot.show{display:block;}

    @media (max-width: 820px){
      body{overflow:auto;}
      .frame{grid-template-rows:auto auto auto;}
      .answers{grid-template-columns:1fr;}
      .hint{white-space:normal;}
    }
  </style>
</head>
<body>
  <div class="splash" id="splash" aria-label="Welcome screen" role="dialog" aria-modal="true">
    <div class="splashBg" aria-hidden="true"></div>
    <div class="splashCard">
      <h1 class="splashTitle">Welcome to Ramadhan Quiz</h1>
      <div class="splashSub">Press Start to begin</div>

      <div class="splashRules splashRulesHidden" id="splashRules" aria-label="How to play">
        <div class="splashRulesGrid">
          <div>
            <h3>üåü Our Teams</h3>
            <div class="teams">
              <div>Team A ‚Äì Leader: Kanza Kiyas</div>
              <div>Team B ‚Äì Leader: Mishari Razick</div>
              <div>Team C ‚Äì Leader: Salih Ayyub</div>
              <div>Team D ‚Äì Leader: Zaim Zakeer</div>
            </div>

            <h3>Levels</h3>
            <div>üîπ Level 1: Easy To Medium Questions</div>
            <div>üî∏ Level 2: Medium To Hard Questions</div>
            <ul>
              <li>Sit in two lines by level.</li>
              <li>Each participant sit one behind the other</li>
            </ul>
          </div>

          <div>
            <h3>How We Play</h3>
            <ul>
              <li>Front person from each team comes forward</li>
              <li>Answer the question</li>
              <li>Go back and sit at the end</li>
              <li>Next person gets ready to play</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="splashActions">
        <button class="btn btnPrimary splashStart" id="btnStart" type="button">Next</button>
        <button class="btn btnPrimary splashStart hidden" id="btnStartGame" type="button">Start Game</button>
      </div>
    </div>
  </div>

  <div class="safe" id="gameRoot">
    <div class="frame" role="application" aria-label="Ramadhan Quiz">
      <div class="topbar">
        <div class="topLeft">
          <button class="btn btnPrimary" id="btnNext" type="button">Next</button>
          <button class="btn" id="btnShowChoices" type="button">Answers</button>
        </div>

        <div class="topRight">
          <div class="pill" id="pillPos" role="button" tabindex="0" aria-label="Question count. Click to end the game.">Q 0 / 0</div>
          <button class="btn" id="btnVoice" type="button">o</button>
          <div class="voicePill hidden" id="voiceStatus" aria-label="Voice status">Voice: Off</div>
          <button class="btn" id="btnScores" type="button">Scores</button>
          <div class="scorePills hidden" id="scorePills" aria-label="Player scores">
            <div class="scorePill" id="scoreA">A: 0</div>
            <div class="scorePill" id="scoreB">B: 0</div>
            <div class="scorePill" id="scoreC">C: 0</div>
            <div class="scorePill" id="scoreD">D: 0</div>
          </div>
          <button class="btn" id="btnRestart" type="button">Reset</button>
          <button class="btn btnPrimary" id="btnShowAnswer" type="button" disabled>Correct Answer</button>
        </div>
      </div>

      <div class="levelWrap" aria-label="Quiz title and levels">
        <div class="levelRow" id="levelRow" aria-label="Levels"></div>
        <div class="levelTitle">Ramadhan Quiz 2026</div>
      </div>

      <div class="stage">
        <div class="panel">
          <div class="question" id="questionCard">
            <div class="levelTag" id="levelTag">Level 1</div>
            <div class="questionText" id="questionText">Loading‚Ä¶</div>
          </div>

          <div class="answers concealed" id="answers" aria-label="Answers"></div>
          <div class="players concealed" id="players" aria-label="Players"></div>
        </div>
      </div>

      <div class="bottom">
        <div class="hint" id="hint"></div>
        <div class="controls"></div>
      </div>
    </div>
  </div>

  <div class="overlay" id="overlay" aria-hidden="true">
    <canvas class="fireworks" id="fireworks" aria-hidden="true"></canvas>
    <div class="modal" role="dialog" aria-modal="true" aria-label="Message">
      <h2 id="overlayTitle">Notice</h2>
      <div id="overlayText"></div>
      <div class="row">
        <button class="btn btnPrimary" id="overlayBtn" type="button">OK</button>
      </div>
    </div>
  </div>
<script id="embeddedQuiz" type="application/json">
{
  "title": "Ramadhan and Fasting ‚Äì MCQ Quiz (Hard)",
  "version": 2,
  "count": 68,
  "questions": [
    {
      "id": 1,
      "question": "Ramadhan begins with the sighting of the",
      "options": ["Sun", "Star", "Moon", "Cloud"],
      "answer": "Moon",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 2,
      "question": "If the moon is not sighted, Sha'ban completes",
      "options": ["31 Days", "30 Days", "29 Days", "28 Days"],
      "answer": "30 Days",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 3,
      "question": "What is the Arabic word for fasting?",
      "options": ["Salah", "Zakat", "Hajj", "Sawm"],
      "answer": "Sawm",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 4,
      "question": "Which Islamic month is Ramadan?",
      "options": ["7th month", "8th month", "9th month", "10th month"],
      "answer": "9th month",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 5,
      "question": "During Ramadan, Shay·π≠ƒÅn is:",
      "options": ["Freed", "Rewarded", "Punished", "Chained"],
      "answer": "Chained",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 6,
      "question": "Which reduces the reward of fasting but does NOT break it?",
      "options": ["Eating", "Drinking", "Lying", "Vomiting"],
      "answer": "Lying",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 7,
      "question": "Which act is Makruh (disliked) while fasting?",
      "options": ["Using miswak", "Smelling perfume deeply", "Making dua", "Reading Qur‚Äôan"],
      "answer": "Smelling perfume deeply",
      "answer_index": 1,
      "level": 1
    },
    {
      "id": 8,
      "question": "The first revelation ‚ÄúIqra‚Äù occurred in:",
      "options": ["Cave Thawr", "Masjid Nabawi", "Makkah market", "Cave Hira"],
      "answer": "Cave Hira",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 9,
      "question": "Which Surah describes Laylatul Qadr?",
      "options": ["Al-Qadr", "Al-Fajr", "Al-Baqarah", "Al-Ikhlas"],
      "answer": "Al-Qadr",
      "answer_index": 0,
      "level": 1
    },
    {
      "id": 10,
      "question": "Muslims fast during Ramadhan from:",
      "options": ["Sunrise to sunset", "Fajr to Maghrib", "Zuhr to Isha", "Sunrise to Isha"],
      "answer": "Fajr to Maghrib",
      "answer_index": 1,
      "level": 1
    },
    {
      "id": 11,
      "question": "The special night in Ramadhan, better than a thousand months, is called:",
      "options": ["Laylatul Isra", "Laylatul Qadr", "Laylatul Miraj", "Laylatul Bara‚Äôah"],
      "answer": "Laylatul Qadr",
      "answer_index": 1,
      "level": 1
    },
    {
      "id": 12,
      "question": "What do we say before we start eating at Iftar?",
      "options": ["Bismillah", "Goodbye", "Thank you", "Welcome"],
      "answer": "Bismillah",
      "answer_index": 0,
      "level": 1
    },
    {
      "id": 13,
      "question": "Taraweeh literally means:",
      "options": ["Standing", "Sleeping", "Resting", "Bowing"],
      "answer": "Resting",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 14,
      "question": "Which of the following INVALIDATES a fast?",
      "options": ["Forgetting and eating", "Vomiting unintentionally", "Swallowing medicine intentionally", "Sleeping all day"],
      "answer": "Swallowing medicine intentionally",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 15,
      "question": "The meal eaten before starting the fast is called:",
      "options": ["Suhoor", "Iftar", "Tea", "Dinner"],
      "answer": "Suhoor",
      "answer_index": 0,
      "level": 1
    },
    {
      "id": 16,
      "question": "The meal to break the fast is called:",
      "options": ["Iftar", "Suhoor", "Breakfast", "Lunch"],
      "answer": "Iftar",
      "answer_index": 0,
      "level": 1
    },
    {
      "id": 17,
      "question": "Special night prayers in Ramadhan are called:",
      "options": ["Fajr", "Taraweeh", "Tahajjud", "Sunnah"],
      "answer": "Taraweeh",
      "answer_index": 1,
      "level": 1
    },
    {
      "id": 18,
      "question": "Fasting during Ramadhan is:",
      "options": ["Optional", "Wajib", "Recommended", "Fard (obligatory)"],
      "answer": "Fard (obligatory)",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 19,
      "question": "Taraweeh is prayed after:",
      "options": ["Fajr", "Zuhr", "Asr", "Isha"],
      "answer": "Isha",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 20,
      "question": "The sunnah method of breaking fast is with?",
      "options": ["Water", "Milk", "Dates", "Bread"],
      "answer": "Dates",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 21,
      "question": "Eid-ul-Fitr marks the completion of?",
      "options": ["Hajj", "Zakah", "Fasting", "Prayer"],
      "answer": "Fasting",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 22,
      "question": "The Eid prayer consists of how many rak‚Äòahs?",
      "options": ["One", "Two", "Three", "Four"],
      "answer": "Two",
      "answer_index": 1,
      "level": 1
    },
    {
      "id": 23,
      "question": "If someone eats forgetfully while fasting, they should:",
      "options": ["Continue fasting", "Stop fasting", "Give Kaffarah", "Repeat the fast"],
      "answer": "Continue fasting",
      "answer_index": 0,
      "level": 1
    },
    {
      "id": 24,
      "question": "The word Qur‚Äôan literally means:",
      "options": ["Book", "Law", "Recitation", "Wisdom"],
      "answer": "Recitation",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 25,
      "question": "Taraweeh prayer during Ramadhan is:",
      "options": ["Fard", "Wajib", "Makruh", "Sunnah"],
      "answer": "Sunnah",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 26,
      "question": "Laylatul Qadr is found in which part of Ramadhan?",
      "options": ["First 10 nights", "Middle 10 nights", "Last 10 nights", "First 5 days"],
      "answer": "Last 10 nights",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 27,
      "question": "What sweet fruit did the Prophet Ô∑∫ like to break his fast with?",
      "options": ["Apple", "Banana", "Dates", "Orange"],
      "answer": "Dates",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 28,
      "question": "Forgetfully eating while fasting requires what action?",
      "options": ["Kaffarah", "Qada", "Fidya", "None"],
      "answer": "None",
      "answer_index": 3,
      "level": 1
    },
    {
      "id": 29,
      "question": "The Qur‚Äôan was revealed gradually over how many years?",
      "options": ["10", "15", "23", "30"],
      "answer": "23",
      "answer_index": 2,
      "level": 1
    },
    {
      "id": 30,
      "question": "A voluntary act (Sunnah) in Ramadan equals how many obligatory (fard) acts in reward?",
      "options": ["Ten", "One", "Seventy", "Hundred"],
      "answer": "One",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 31,
      "question": "One obligatory act (fard) in Ramadan equals how many obligatory acts at another time (according to the narration)?",
      "options": ["Seven", "Seventy", "Hundred", "Ten"],
      "answer": "Seventy",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 32,
      "question": "Umrah in Ramadan equals the reward of which act?",
      "options": ["Salah", "Zakah", "Hajj", "Sawm"],
      "answer": "Hajj",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 33,
      "question": "The Conquest of Makkah occurred on which day of Ramadan?",
      "options": ["10th", "17th", "20th", "27th"],
      "answer": "20th",
      "answer_index": 2,
      "level": 3
    },
    {
      "id": 34,
      "question": "I‚Äôtikaf (seclusion in the mosque) is especially observed during:",
      "options": ["First 10 days of Ramadhan", "Last 10 nights of Ramadhan", "First 5 nights of Ramadhan", "Entire month"],
      "answer": "Last 10 nights of Ramadhan",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 35,
      "question": "Giving Zakat-ul-Fitr purifies the fast from?",
      "options": ["Hunger", "Sleep", "Mistakes", "Travel"],
      "answer": "Mistakes",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 36,
      "question": "The first battle in Islam was:",
      "options": ["Uhud", "Khandaq", "Badr", "Hunain"],
      "answer": "Badr",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 37,
      "question": "Fidya is given by a person who:",
      "options": ["Missed one fast", "Is permanently ill", "Forgot to fast", "Slept late"],
      "answer": "Is permanently ill",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 38,
      "question": "Which condition is NOT required for fasting to be obligatory?",
      "options": ["Islam", "Sanity", "Puberty", "Wealth"],
      "answer": "Wealth",
      "answer_index": 3,
      "level": 2
    },
    {
      "id": 39,
      "question": "If someone breaks a Ramadhan fast thinking Maghrib has started, but it has not, they must:",
      "options": ["Do nothing", "Give Fidya", "Repeat fast (Qada)", "Give Kaffarah"],
      "answer": "Repeat fast (Qada)",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 40,
      "question": "The main purpose of fasting mentioned in the Qur‚Äôan is to gain:",
      "options": ["Strength", "Wealth", "Knowledge", "Taqwa"],
      "answer": "Taqwa",
      "answer_index": 3,
      "level": 2
    },
    {
      "id": 41,
      "question": "The first battle that occurred during Ramadhan was:",
      "options": ["Uhud", "Badr", "Khandaq", "Hunain"],
      "answer": "Badr",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 42,
      "question": "Which event is NOT associated with Ramadhan?",
      "options": ["Revelation of the Qur‚Äôan", "Battle of Badr", "Laylatul Qadr", "Hijrah to Madinah"],
      "answer": "Hijrah to Madinah",
      "answer_index": 3,
      "level": 2
    },
    {
      "id": 43,
      "question": "Who organized Taraweeh in congregation during his caliphate?",
      "options": ["Abu Bakr (RA)", "Umar ibn Al-Khattab (RA)", "Uthman (RA)", "Ali (RA)"],
      "answer": "Umar ibn Al-Khattab (RA)",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 44,
      "question": "What is the recommended act during the last ten nights of Ramadhan?",
      "options": ["Fasting only", "I‚Äôtikaf", "Charity", "Traveling"],
      "answer": "I‚Äôtikaf",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 45,
      "question": "When should Zakat al-Fitr be paid?",
      "options": ["Before Ramadhan", "Before Eid prayer", "After Eid prayer", "Anytime in Shawwal"],
      "answer": "Before Eid prayer",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 46,
      "question": "Charity given to the poor at the end of Ramadhan is called:",
      "options": ["Zakat al-Mal", "Zakat al-Fitr", "Sadaqah", "Kaffarah"],
      "answer": "Zakat al-Fitr",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 47,
      "question": "Laylatul Qadr is searched in which category of nights?",
      "options": ["Even", "First", "Odd", "Last"],
      "answer": "Odd",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 48,
      "question": "The first ten days of Ramadhan are known as the days of?",
      "options": ["Maghfirah", "Najah", "Rahmah", "Itqu minannar"],
      "answer": "Rahmah",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 49,
      "question": "The last ten days of Ramadhan are associated with freedom from?",
      "options": ["Hunger", "Sin", "Hell Fire", "Fear"],
      "answer": "Hell Fire",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 50,
      "question": "Which act is prohibited on Eid-ul-Fitr?",
      "options": ["Prayer", "Charity", "Fasting", "Takbeer"],
      "answer": "Fasting",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 51,
      "question": "Which Surah mentions fasting as an obligation?",
      "options": ["Al-Ma‚Äôidah", "Al-Baqarah", "Al-Imran", "Al-Nisa"],
      "answer": "Al-Baqarah",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 52,
      "question": "Which group is allowed to miss fasting and make it up later?",
      "options": ["Children", "Travelers", "Angels", "Teachers"],
      "answer": "Travelers",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 53,
      "question": "Which Surah mentions Ramadhan by name?",
      "options": ["Al-Qadr", "Al-Baqarah", "Al-Fajr", "Al-Shams"],
      "answer": "Al-Baqarah",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 54,
      "question": "The Battle of Badr took place on which Islamic date?",
      "options": ["1 Ramadhan", "10 Ramadhan", "17 Ramadhan", "27 Ramadhan"],
      "answer": "17 Ramadhan",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 55,
      "question": "The number of enemies at Badr was about:",
      "options": ["500", "700", "900", "1000"],
      "answer": "1000",
      "answer_index": 3,
      "level": 2
    },
    {
      "id": 56,
      "question": "The second ten days of Ramadhan emphasize seeking:",
      "options": ["Patience", "Charity", "Maghfirah", "Guidance"],
      "answer": "Maghfirah",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 57,
      "question": "Which Sahabi is known for writing down the Qur'an during the Prophet's life time?",
      "options": ["Zayd", "Uthman", "Abdullah", "Ali"],
      "answer": "Zayd",
      "answer_index": 0,
      "level": 2
    },
    {
      "id": 58,
      "question": "Zakat al-Fitr is obligatory on:",
      "options": ["Only men", "Only children", "Every Muslim who possesses surplus food", "Only the poor"],
      "answer": "Every Muslim who possesses surplus food",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 59,
      "question": "The gate of Jannah reserved for those who fast is named?",
      "options": ["Firdaus", "Salam", "Rayyan", "Noor"],
      "answer": "Rayyan",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 60,
      "question": "The Arabic word Itqu-minan-Naar means?",
      "options": ["Protection from evil", "Forgiveness of sins", "Freedom From Hell Fire", "Guidance"],
      "answer": "Freedom From Hell Fire",
      "answer_index": 2,
      "level": 2
    },
    {
      "id": 61,
      "question": "The reward for fasting 6 days in Shawwal equals fasting for:",
      "options": ["Month", "Year", "Week", "Lifetime"],
      "answer": "Year",
      "answer_index": 1,
      "level": 2
    },
    {
      "id": 62,
      "question": "What is the meaning of Ramadan?",
      "options": ["Celebration", "Light", "Intense heat", "Peace"],
      "answer": "Intense heat",
      "answer_index": 2,
      "level": 3
    },
    {
      "id": 63,
      "question": "The fast of a pregnant or feeding woman who fears harm to child is:",
      "options": ["Obligatory", "Wajib", "Exempt with Qada later", "Exempt with Fidya & Qada allowed"],
      "answer": "Exempt with Fidya & Qada allowed",
      "answer_index": 3,
      "level": 3
    },
    {
      "id": 64,
      "question": "Which companion is called ‚ÄúDhul-Nurayn‚Äù?",
      "options": ["Uthman", "Umar", "Ali", "Abu Bakr"],
      "answer": "Uthman",
      "answer_index": 0,
      "level": 3
    },
    {
      "id": 65,
      "question": "How much Zakat al-Fitr is given per person?",
      "options": ["One sa‚Äò of food (approx. 2‚Äì3 kg)", "Half sa‚Äò of food", "One sa‚Äò of gold", "Any amount one wishes"],
      "answer": "One sa‚Äò of food (approx. 2‚Äì3 kg)",
      "answer_index": 0,
      "level": 3
    },
    {
      "id": 66,
      "question": "The Takbeer of Eid-ul-Fitr begins from?",
      "options": ["Fajr Of Shawwal", "Sunrise Of Shawwal", "Sunset Of Last Ramadhan Day", "Before Eid Prayer"],
      "answer": "Sunset Of Last Ramadhan Day",
      "answer_index": 2,
      "level": 3
    },
    {
      "id": 67,
      "question": "The main difference between Fidya and Kaffarah is:",
      "options": ["Fidya is optional, Kaffarah is mandatory", "Fidya is compensation for inability, Kaffarah is penalty for deliberate breaking", "Fidya is only for old people, Kaffarah is only for the young", "Fidya is paid in money, Kaffarah is paid in gold"],
      "answer": "Fidya is compensation for inability, Kaffarah is penalty for deliberate breaking",
      "answer_index": 1,
      "level": 3
    },
    {
      "id": 68,
      "question": "Which of the following applies to Kaffarah?",
      "options": ["It is given when someone cannot fast due to old age", "It is a replacement for missed fasts due to illness", "It is required when someone deliberately breaks a fast in Ramadan", "It is optional for missed voluntary fasts"],
      "answer": "It is required when someone deliberately breaks a fast in Ramadan",
      "answer_index": 2,
      "level": 3
    }
  ]
}
</script>
<script id="embeddedQuiz2" type="application/json">
{
  "title": "Ramadhan and Fasting ‚Äì MCQ Quiz (Hard)",
  "version": 2,
  "count": 2,
  "questions": [
    {
      "id": 1,
      "question": "what is 1+1",
      "options": ["2","3","4","5"],
      "answer": "2",
      "answer_index": 0,
      "level": 1
    },
    {
      "id": 2,
      "question": "what 10 / 2",
      "options": ["5","6","7","8"],
      "answer": "5",
      "answer_index": 0,
      "level": 1
    }
  ]
}
</script>

  <script>
    const DEFAULT_DATA_FILE2 = "slmcfmk_quiz_dec2025.json";
    const DEFAULT_DATA_FILE = "ram_quiz.json";

    function getEmbeddedQuizJson() {
      const el = document.getElementById("embeddedQuiz");
      if (!el) return null;
      const raw = (el.textContent ?? "").trim();
      if (!raw) return null;
      try {
        return JSON.parse(raw);
      } catch {
        return null;
      }
    }
    function storageKeyFor(dataFile) {
      return `ramadhan_quiz_state::${dataFile}`;
    }

    const els = {
      splash: document.getElementById("splash"),
      btnStart: document.getElementById("btnStart"),
      btnStartGame: document.getElementById("btnStartGame"),
      splashRules: document.getElementById("splashRules"),
      gameRoot: document.getElementById("gameRoot"),
      pillPos: document.getElementById("pillPos"),
      levelTag: document.getElementById("levelTag"),
      levelRow: document.getElementById("levelRow"),
      questionCard: document.getElementById("questionCard"),
      scorePills: document.getElementById("scorePills"),
      scoreA: document.getElementById("scoreA"),
      scoreB: document.getElementById("scoreB"),
      scoreC: document.getElementById("scoreC"),
      scoreD: document.getElementById("scoreD"),
      questionText: document.getElementById("questionText"),
      answers: document.getElementById("answers"),
      players: document.getElementById("players"),
      hint: document.getElementById("hint"),
      btnNext: document.getElementById("btnNext"),
      btnRestart: document.getElementById("btnRestart"),
      btnVoice: document.getElementById("btnVoice"),
      voiceStatus: document.getElementById("voiceStatus"),
      btnScores: document.getElementById("btnScores"),
      btnShowChoices: document.getElementById("btnShowChoices"),
      btnShowAnswer: document.getElementById("btnShowAnswer"),
      overlay: document.getElementById("overlay"),
      overlayTitle: document.getElementById("overlayTitle"),
      overlayText: document.getElementById("overlayText"),
      overlayBtn: document.getElementById("overlayBtn"),
      fireworks: document.getElementById("fireworks"),
    };

    function getDataFile() {
      const url = new URL(window.location.href);
      return url.searchParams.get("data") || DEFAULT_DATA_FILE;
    }

    function showOverlay(title, text) {
      els.overlayTitle.textContent = title;
      els.overlayText.textContent = text;
      els.overlay.classList.add("show");
      els.overlay.setAttribute("aria-hidden", "false");
      els.overlayBtn.focus();
    }

    function showOverlayHtml(title, html) {
      els.overlayTitle.textContent = title;
      els.overlayText.innerHTML = html;
      els.overlay.classList.add("show");
      els.overlay.setAttribute("aria-hidden", "false");
      els.overlayBtn.focus();
    }

    let fireworksRAF = null;
    let fireworksParticles = [];
    let fireworksLast = 0;
    let fireworksNextBurstAt = 0;

    function resizeFireworksCanvas() {
      if (!els.fireworks) return;
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const w = Math.floor(window.innerWidth);
      const h = Math.floor(window.innerHeight);
      els.fireworks.width = Math.floor(w * dpr);
      els.fireworks.height = Math.floor(h * dpr);
      const ctx = els.fireworks.getContext("2d");
      if (ctx) ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    function spawnBurst() {
      const w = window.innerWidth;
      const h = window.innerHeight;
      const x = Math.random() * w;
      const y = (Math.random() * 0.45 + 0.1) * h;
      const colors = ["#F59E0B", "#22C55E", "#60A5FA", "#F472B6", "#A78BFA", "#FBBF24"]; 
      const color = colors[(Math.random() * colors.length) | 0];
      const count = 42 + ((Math.random() * 26) | 0);
      for (let i = 0; i < count; i++) {
        const a = (Math.PI * 2 * i) / count + (Math.random() * 0.15);
        const sp = 140 + Math.random() * 220;
        fireworksParticles.push({
          x, y,
          vx: Math.cos(a) * sp,
          vy: Math.sin(a) * sp,
          life: 1,
          r: 2 + Math.random() * 2.5,
          color,
        });
      }
    }

    function startFireworks() {
      if (!els.fireworks) return;
      stopFireworks();
      resizeFireworksCanvas();
      fireworksParticles = [];
      fireworksLast = performance.now();
      fireworksNextBurstAt = fireworksLast + 50;

      const ctx = els.fireworks.getContext("2d");
      if (!ctx) return;

      const step = (t) => {
        fireworksRAF = requestAnimationFrame(step);
        const dt = Math.min(0.033, (t - fireworksLast) / 1000);
        fireworksLast = t;

        ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        if (t >= fireworksNextBurstAt) {
          spawnBurst();
          fireworksNextBurstAt = t + 350 + Math.random() * 650;
        }

        const g = 380;
        for (let i = fireworksParticles.length - 1; i >= 0; i--) {
          const p = fireworksParticles[i];
          p.vy += g * dt;
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.vx *= (1 - 1.8 * dt);
          p.vy *= (1 - 0.6 * dt);
          p.life -= 0.9 * dt;

          if (p.life <= 0) {
            fireworksParticles.splice(i, 1);
            continue;
          }

          ctx.globalAlpha = Math.max(0, Math.min(1, p.life));
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;
      };

      fireworksRAF = requestAnimationFrame(step);
      window.addEventListener("resize", resizeFireworksCanvas);
    }

    function stopFireworks() {
      if (fireworksRAF) cancelAnimationFrame(fireworksRAF);
      fireworksRAF = null;
      fireworksParticles = [];
      window.removeEventListener("resize", resizeFireworksCanvas);
      if (els.fireworks) {
        const ctx = els.fireworks.getContext("2d");
        if (ctx) ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);
      }
    }

    function hideOverlay() {
      els.overlay.classList.remove("show");
      els.overlay.setAttribute("aria-hidden", "true");
      stopFireworks();
    }

    els.overlayBtn.addEventListener("click", hideOverlay);

    function shuffleInPlace(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function sortQuestionsByIdInPlace(qs) {
      qs.sort((a, b) => {
        const al = (typeof a?.level === "number") ? a.level : parseInt(a?.level ?? "1", 10) || 1;
        const bl = (typeof b?.level === "number") ? b.level : parseInt(b?.level ?? "1", 10) || 1;
        if (al !== bl) return al - bl;

        const ai = (typeof a?.id === "number") ? a.id : parseInt(a?.id ?? "0", 10) || 0;
        const bi = (typeof b?.id === "number") ? b.id : parseInt(b?.id ?? "0", 10) || 0;
        return ai - bi;
      });
      return qs;
    }

    function normalizeQuestions(rawQuestions) {
      const qs = (Array.isArray(rawQuestions) ? rawQuestions : [])
        .filter(q => q && typeof q === "object")
        .map(q => ({
          id: q.id ?? null,
          level: (typeof q.level === "number") ? q.level : (Number.isFinite(parseInt(q.level, 10)) ? parseInt(q.level, 10) : 1),
          question: String(q.question ?? ""),
          options: Array.isArray(q.options) ? q.options.map(x => String(x)) : [],
          answer_index: (typeof q.answer_index === "number") ? q.answer_index : null,
          answer: (typeof q.answer === "string") ? q.answer : null,
        }));

      sortQuestionsByIdInPlace(qs);

      qs.forEach(q => {
        if (!Array.isArray(q.options) || q.options.length !== 4) return;

        const answerText = (typeof q.answer_index === "number")
          ? q.options[q.answer_index]
          : (q.answer ?? null);

        const options = q.options.map(text => ({ text }));
        shuffleInPlace(options);
        q.options = options.map(o => o.text);

        if (answerText !== null) {
          q.answer_index = q.options.findIndex(t => t === answerText);
          q.answer = answerText;
        }
      });

      return qs.filter(q => q.question && Array.isArray(q.options) && q.options.length === 4 && typeof q.answer_index === "number" && q.answer_index >= 0);
    }

    let QUIZ = null;
    let QUESTIONS = [];
    let idx = 0;
    let focused = 0;
    let locked = false;
    let chosenIndex = null;

    const PLAYER_LABELS = ["A", "B", "C", "D"];
    const playerScores = [0, 0, 0, 0];
    let playerPicks = [null, null, null, null];
    let activePlayer = 0;
    let revealed = false;
    let scoredThisQuestion = false;
    let stage = "question"; // question | choices | revealed
    let selectedLevel = null;
    let levelIndices = [];

    function loadState(dataFile) {
      try {
        const raw = window.localStorage.getItem(storageKeyFor(dataFile));
        if (!raw) return null;
        const st = JSON.parse(raw);
        if (!st || typeof st !== "object") return null;
        if (st.dataFile !== dataFile) return null;
        if (!Array.isArray(st.playerScores) || st.playerScores.length !== 4) return null;
        if (typeof st.idx !== "number") return null;
        return st;
      } catch {
        return null;
      }
    }

    function saveState(dataFile) {
      try {
        const st = {
          v: 1,
          dataFile,
          savedAt: Date.now(),
          idx,
          selectedLevel,
          activePlayer,
          playerScores: [...playerScores],
          playerPicks: [...playerPicks],
          stage,
        };
        window.localStorage.setItem(storageKeyFor(dataFile), JSON.stringify(st));
      } catch {
        // ignore
      }
    }

    function clearState(dataFile) {
      try {
        window.localStorage.removeItem(storageKeyFor(dataFile));
      } catch {
        // ignore
      }
    }

    function setTop() {
      if (selectedLevel && levelIndices.length) {
        const pos = Math.max(0, levelIndices.indexOf(idx));
        els.pillPos.textContent = `Q ${Math.min(pos + 1, levelIndices.length)} / ${levelIndices.length}`;
      } else {
        els.pillPos.textContent = `Q ${Math.min(idx + 1, QUESTIONS.length)} / ${QUESTIONS.length}`;
      }
      els.scoreA.textContent = `A: ${playerScores[0]}`;
      els.scoreB.textContent = `B: ${playerScores[1]}`;
      els.scoreC.textContent = `C: ${playerScores[2]}`;
      els.scoreD.textContent = `D: ${playerScores[3]}`;
    }

    function setScoresVisible(visible) {
      if (!els.scorePills) return;
      if (visible) els.scorePills.classList.remove("hidden");
      else els.scorePills.classList.add("hidden");
    }

    function setEndedUi(ended) {
      els.btnNext.disabled = ended;
      els.btnShowChoices.disabled = ended;
      els.btnShowAnswer.disabled = ended;
      if (els.btnScores) els.btnScores.disabled = false;
    }

    function endGameNow() {
      const max = Math.max(...playerScores);
      const winners = PLAYER_LABELS.filter((_, i) => playerScores[i] === max);
      const winnerText = (winners.length === 1)
        ? `Winner is ${winners[0]}`
        : `Winners are ${winners.join(" & ")}`;
      const scoresHtml = `
        <div class="winnerScores" aria-label="Final scores">
          <div class="winnerScoreCircle"><div class="winnerScoreLabel">A</div><div class="winnerScoreValue">${playerScores[0]}</div></div>
          <div class="winnerScoreCircle"><div class="winnerScoreLabel">B</div><div class="winnerScoreValue">${playerScores[1]}</div></div>
          <div class="winnerScoreCircle"><div class="winnerScoreLabel">C</div><div class="winnerScoreValue">${playerScores[2]}</div></div>
          <div class="winnerScoreCircle"><div class="winnerScoreLabel">D</div><div class="winnerScoreValue">${playerScores[3]}</div></div>
        </div>`;
      showOverlayHtml(
        "Game Over. Hope You All Enjoyed The Quiz!",
        `<div class="winnerLine">${winnerText}</div>${scoresHtml}`
      );
      startFireworks();
      setEndedUi(true);
    }

    function startGame() {
      if (els.splash) els.splash.classList.add("splashHidden");
      if (els.gameRoot) els.gameRoot.classList.add("show");
      const target = (!els.btnNext.disabled) ? els.btnNext : els.btnShowChoices;
      target?.focus();
    }

    function showSplashRules() {
      if (els.splashRules) els.splashRules.classList.remove("splashRulesHidden");
      if (els.btnStart) els.btnStart.classList.add("hidden");
      if (els.btnStartGame) els.btnStartGame.classList.remove("hidden");
      els.btnStartGame?.focus();
    }

    const Voice = {
      recognition: null,
      enabled: false,
      supported: false,
      starting: false,
    };

    function setVoiceStatus(text) {
      return;
    }

    function setVoiceHeard(text) {
      return;
    }

    function canExecuteVoiceActions() {
      if (!els.splash || !els.gameRoot) return true;
      const inSplash = !els.splash.classList.contains("splashHidden");
      const gameVisible = els.gameRoot.classList.contains("show");
      return !inSplash && gameVisible;
    }

    function executeVoiceCommand(command) {
      if (!canExecuteVoiceActions()) return;
      if (els.overlay && els.overlay.classList.contains("show")) return;

      if (command === "select next" || command === "next") {
        els.btnNext?.click();
        return;
      }
      if (command === "show answers" || command === "show choices") {
        els.btnShowChoices?.click();
        return;
      }
      if (command === "show answer" || command === "correct answer") {
        if (!els.btnShowAnswer?.disabled) els.btnShowAnswer?.click();
        return;
      }
      if (command === "show score" || command === "the score") {
        els.btnScores?.click();
        return;
      }
    }

    function parseTranscriptToCommand(t) {
      const s = String(t || "").toLowerCase().replace(/[^a-z\s]/g, " ").replace(/\s+/g, " ").trim();
      const i = s.indexOf("computer g");
      if (i < 0) return null;
      const after = s.slice(i + "computer g".length).trim();
      if (!after) return null;

      // Ignore extra filler words; just look for keywords/phrases anywhere after the wake phrase.
      const a = after;

      if (a.includes("select next") || a.includes("next please") || a.includes("next question") || a.includes("next")) {
        return "select next";
      }

      // Choices / answers list
      if (
        a.includes("the choices") ||
        a.includes("show choice") ||
        a.includes("show answers") ||
        a.includes("options") ||
        a.includes("option") ||
        a.includes("choices") ||
        a.includes("choice") ||
        a.includes("chices")
      ) {
        return "show choices";
      }

      // Correct answer
      if (a.includes("correct answer") || a.includes("show answer") || a.includes("the answer")) {
        return "correct answer";
      }

      // Scores
      if (a.includes("show score") || a.includes("the score") || a.includes("score") || a.includes("scores")) {
        return "show score";
      }

      return null;
    }

    function initVoiceControl() {
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      Voice.supported = Boolean(SR);
      if (!Voice.supported) {
        setVoiceStatus("Voice: Unsupported");
        if (els.btnVoice) els.btnVoice.disabled = true;
        return;
      }

      const rec = new SR();
      Voice.recognition = rec;
      rec.continuous = true;
      rec.interimResults = false;
      rec.lang = "en-US";

      rec.onstart = () => {
        Voice.starting = false;
        els.btnVoice?.classList.add("btnVoiceActive");
        setVoiceStatus("Voice: Listening");
      };
      rec.onend = () => {
        if (!Voice.enabled) {
          els.btnVoice?.classList.remove("btnVoiceActive");
          setVoiceStatus("Voice: Off");
          return;
        }
        setVoiceStatus("Voice: Restarting");
        window.setTimeout(() => {
          if (!Voice.enabled) return;
          try { rec.start(); } catch {}
        }, 250);
      };
      rec.onerror = () => {
        if (!Voice.enabled) return;
        setVoiceStatus("Voice: Error");
      };
      rec.onresult = (e) => {
        const last = e.results?.[e.results.length - 1];
        const txt = last?.[0]?.transcript ?? "";
        try {
          console.log("[Voice] transcript:", txt);
        } catch {}
        setVoiceHeard(txt);
        const cmd = parseTranscriptToCommand(txt);
        try {
          console.log("[Voice] parsed command:", cmd);
        } catch {}
        if (cmd) executeVoiceCommand(cmd);
      };

      setVoiceStatus("Voice: Off");
    }

    function toggleVoice() {
      if (!Voice.supported || !Voice.recognition) return;
      Voice.enabled = !Voice.enabled;
      if (!Voice.enabled) {
        els.btnVoice?.classList.remove("btnVoiceActive");
        setVoiceStatus("Voice: Off");
        try { Voice.recognition.stop(); } catch {}
        return;
      }
      if (Voice.starting) return;
      Voice.starting = true;
      setVoiceStatus("Voice: Starting");
      try { Voice.recognition.start(); } catch {
        Voice.starting = false;
        setVoiceStatus("Voice: Error");
      }
    }

    function rebuildLevelIndices() {
      if (!selectedLevel) {
        levelIndices = [];
        return;
      }
      levelIndices = [];
      for (let i = 0; i < QUESTIONS.length; i++) {
        const q = QUESTIONS[i];
        const lvl = (typeof q.level === "number") ? q.level : parseInt(q.level ?? "1", 10) || 1;
        if (lvl === selectedLevel) levelIndices.push(i);
      }
    }

    function renderLevelRow() {
      if (!els.levelRow) return;
      els.levelRow.innerHTML = "";
      [1, 2, 3].forEach((lvl) => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "levelBtn" + (selectedLevel === lvl ? " levelBtnActive" : "");
        b.textContent = `Level ${lvl}`;
        b.addEventListener("click", () => {
          if (selectedLevel === lvl) {
            selectedLevel = null;
          } else {
            selectedLevel = lvl;
          }
          rebuildLevelIndices();
          if (selectedLevel) {
            if (!levelIndices.length) {
              selectedLevel = null;
              rebuildLevelIndices();
              renderLevelRow();
              setTop();
              saveState(getDataFile());
              showOverlay("No questions", `No questions found for Level ${lvl}.`);
              return;
            }
            idx = levelIndices[0];
          }
          renderLevelRow();
          renderQuestion();
          setTop();
          saveState(getDataFile());
        });
        els.levelRow.appendChild(b);
      });
    }

    function getNextIndex() {
      if (selectedLevel && levelIndices.length) {
        const pos = levelIndices.indexOf(idx);
        const nextPos = (pos >= 0) ? ((pos + 1) % levelIndices.length) : 0;
        return levelIndices[nextPos];
      }
      return idx + 1;
    }

    function clearFocusClasses() {
      const cards = Array.from(els.answers.querySelectorAll(".ans"));
      cards.forEach((c) => {
        c.classList.remove("ansFocus", "ansSelected");
        c.setAttribute("aria-disabled", locked ? "true" : "false");
      });
    }

    function applyFocus() {
      clearFocusClasses();
      const cards = Array.from(els.answers.querySelectorAll(".ans"));
      cards.forEach((c, i) => {
        if (focused >= 0 && i === focused) c.classList.add("ansFocus");
        if ((stage === "revealed" || revealed) && chosenIndex === i) c.classList.add("ansSelected");
      });
    }

    function renderQuestion() {
      if (!QUESTIONS.length) return;

      locked = false;
      chosenIndex = null;
      els.btnNext.disabled = false;
      els.hint.textContent = "";
      revealed = false;
      scoredThisQuestion = false;
      playerPicks = [null, null, null, null];
      stage = "question";
      els.answers.classList.add("concealed");
      els.players.classList.add("concealed");
      els.btnShowChoices.disabled = false;
      els.btnShowAnswer.disabled = true;

      const q = QUESTIONS[idx];
      els.questionText.textContent = q.question;
      els.levelTag.textContent = "";

      const letters = ["1", "2", "3", "4"];
      els.answers.innerHTML = "";

      q.options.forEach((text, i) => {
        const btn = document.createElement("div");
        btn.className = "ans";
        btn.setAttribute("role", "button");
        btn.setAttribute("tabindex", "-1");
        btn.setAttribute("aria-disabled", "false");
        btn.dataset.index = String(i);

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = letters[i];

        const span = document.createElement("div");
        span.className = "ansText";
        span.textContent = text;

        btn.appendChild(badge);
        btn.appendChild(span);

        btn.addEventListener("click", () => {
          focused = i;
          chooseFocused();
        });

        els.answers.appendChild(btn);
      });

      focused = -1;
      setTop();
      applyFocus();

      renderPlayers();

      saveState(getDataFile());
    }

    function showChoices() {
      if (!QUESTIONS.length) return;
      if (stage !== "question") return;
      stage = "choices";
      els.answers.classList.remove("concealed");
      els.players.classList.remove("concealed");
      els.btnShowChoices.disabled = true;
      els.btnShowAnswer.disabled = false;
      activePlayer = 0;
      focused = -1;
      applyFocus();
      renderPlayers();
      saveState(getDataFile());
    }

    function renderPlayers() {
      els.players.innerHTML = "";
      PLAYER_LABELS.forEach((label, pi) => {
        const c = document.createElement("div");
        c.className = "playerCircle" + (pi === activePlayer ? " playerCircleActive" : "");
        c.setAttribute("role", "button");
        c.setAttribute("tabindex", "-1");
        c.dataset.player = String(pi);

        const t = document.createElement("div");
        t.className = "playerLabel";
        t.textContent = label;

        c.appendChild(t);

        const pick = playerPicks[pi];
        if ((stage === "choices" || stage === "revealed" || revealed) && typeof pick === "number") {
          const p = document.createElement("div");
          p.className = "playerPick";
          if (stage === "revealed" || revealed) p.textContent = String(pick + 1);
          c.appendChild(p);
        }

        c.addEventListener("click", () => {
          if (revealed) return;
          activePlayer = pi;
          renderPlayers();
        });

        els.players.appendChild(c);
      });
    }

    function chooseFocused() {
      const q = QUESTIONS[idx];
      const cards = Array.from(els.answers.querySelectorAll(".ans"));

      if (revealed) return;
      if (stage !== "choices") return;

      chosenIndex = focused;

      // Save this player's pick (no red/green highlighting at this stage)
      playerPicks[activePlayer] = chosenIndex;
      renderPlayers();

      // Keep answers clickable until reveal
      cards.forEach((c) => c.setAttribute("aria-disabled", "false"));

      setTop();
      focused = -1;
      applyFocus();

      saveState(getDataFile());
    }

    function showAnswer() {
      if (!QUESTIONS.length) return;
      if (revealed) return;
      if (stage !== "choices") return;

      revealed = true;
      stage = "revealed";

      const q = QUESTIONS[idx];
      const cards = Array.from(els.answers.querySelectorAll(".ans"));

      // Highlight only the correct answer in green
      cards.forEach((c) => c.classList.remove("ansWrong", "ansCorrect"));
      cards[q.answer_index]?.classList.add("ansCorrect");
      cards.forEach((c) => c.setAttribute("aria-disabled", "true"));

      // Score: +2 for each player who picked correctly
      if (!scoredThisQuestion) {
        playerPicks.forEach((pick, pi) => {
          if (typeof pick === "number" && pick === q.answer_index) playerScores[pi] += 2;
        });
        scoredThisQuestion = true;
      }

      els.btnNext.disabled = false;
      setTop();
      renderPlayers();

      saveState(getDataFile());
    }

    function nextQuestion() {
      if (!QUESTIONS.length) return;
      if (!selectedLevel && idx >= QUESTIONS.length - 1) {
        const max = Math.max(...playerScores);
        const winners = PLAYER_LABELS.filter((_, i) => playerScores[i] === max);
        const winnerText = (winners.length === 1)
          ? `Winner is ${winners[0]}`
          : `Winners are ${winners.join(" & ")}`;
        const scoresHtml = `
          <div class="winnerScores" aria-label="Final scores">
            <div class="winnerScoreCircle"><div class="winnerScoreLabel">A</div><div class="winnerScoreValue">${playerScores[0]}</div></div>
            <div class="winnerScoreCircle"><div class="winnerScoreLabel">B</div><div class="winnerScoreValue">${playerScores[1]}</div></div>
            <div class="winnerScoreCircle"><div class="winnerScoreLabel">C</div><div class="winnerScoreValue">${playerScores[2]}</div></div>
            <div class="winnerScoreCircle"><div class="winnerScoreLabel">D</div><div class="winnerScoreValue">${playerScores[3]}</div></div>
          </div>`;
        showOverlayHtml(
          "Game Over. Hope You All Enjoyed The Quiz!",
          `<div class="winnerLine">${winnerText}</div>${scoresHtml}`
        );
        startFireworks();
        return;
      }

      // Hide scores again when moving to next question
      setScoresVisible(false);

      if (selectedLevel && levelIndices.length) {
        idx = getNextIndex();
      } else {
        idx += 1;
      }
      renderQuestion();

      saveState(getDataFile());
    }

    function restart() {
      const dataFile = getDataFile();
      clearState(dataFile);
      idx = 0;
      selectedLevel = null;
      levelIndices = [];
      setScoresVisible(false);
      playerScores[0] = 0;
      playerScores[1] = 0;
      playerScores[2] = 0;
      playerScores[3] = 0;
      activePlayer = 0;
      renderLevelRow();
      renderQuestion();
      setTop();

      saveState(dataFile);
    }

    function moveFocus(dir) {
      if (revealed) return;
      if (stage !== "choices") return;

      if (focused < 0) {
        focused = 0;
        applyFocus();
        return;
      }

      const row = Math.floor(focused / 2);
      const col = focused % 2;

      if (dir === "left") focused = row * 2 + Math.max(0, col - 1);
      if (dir === "right") focused = row * 2 + Math.min(1, col + 1);
      if (dir === "up") focused = Math.max(0, focused - 2);
      if (dir === "down") focused = Math.min(3, focused + 2);

      applyFocus();
    }

    document.addEventListener("keydown", (e) => {
      if (els.overlay.classList.contains("show")) {
        if (e.key === "Enter" || e.key === "Escape") hideOverlay();
        return;
      }

      if (e.key === "ArrowLeft") { e.preventDefault(); moveFocus("left"); }
      if (e.key === "ArrowRight") { e.preventDefault(); moveFocus("right"); }
      if (e.key === "ArrowUp") { e.preventDefault(); moveFocus("up"); }
      if (e.key === "ArrowDown") { e.preventDefault(); moveFocus("down"); }

      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        chooseFocused();
      }

      if (e.key === "s" || e.key === "S") {
        e.preventDefault();
        showAnswer();
      }

      if (e.key === "n" || e.key === "N") {
        if (!els.btnNext.disabled) nextQuestion();
      }

      if (e.key === "r" || e.key === "R") {
        const ok = window.confirm("Reset the game? This will clear scores and restart from the beginning.");
        if (ok) restart();
      }
    });

    els.btnNext.addEventListener("click", nextQuestion);
    els.btnRestart.addEventListener("click", () => {
      const ok = window.confirm("Reset the game? This will clear scores and restart from the beginning.");
      if (ok) restart();
    });
    els.btnShowChoices.addEventListener("click", showChoices);
    els.btnShowAnswer.addEventListener("click", showAnswer);

    initVoiceControl();
    els.btnVoice?.addEventListener("click", toggleVoice);

    els.btnScores?.addEventListener("click", () => {
      const isHidden = els.scorePills?.classList.contains("hidden");
      setScoresVisible(Boolean(isHidden));
    });

    els.scorePills?.addEventListener("click", () => {
      setScoresVisible(false);
    });

    els.pillPos?.addEventListener("click", () => {
      const ok = window.confirm("End the game now and show the winner?");
      if (ok) endGameNow();
    });

    els.pillPos?.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        const ok = window.confirm("End the game now and show the winner?");
        if (ok) endGameNow();
      }
    });

    els.btnStart?.addEventListener("click", showSplashRules);
    els.btnStartGame?.addEventListener("click", startGame);
    document.addEventListener("keydown", (e) => {
      if (!els.splash || els.splash.classList.contains("splashHidden")) return;
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        const showingRules = els.splashRules && !els.splashRules.classList.contains("splashRulesHidden");
        if (showingRules) startGame();
        else showSplashRules();
      }
    });

    async function loadQuiz() {
      const dataFile = getDataFile();
      try {
        const embedded = getEmbeddedQuizJson();
        let json;
        if (embedded) {
          json = embedded;
        } else {
          // const res = await fetch(dataFile, { cache: "no-store" });
          // if (!res.ok) throw new Error(`HTTP ${res.status}`);
          // json = await res.json();
          throw new Error("Embedded quiz JSON not found. External JSON loading is currently disabled.");
        }

        QUIZ = json;
        const title = (json && typeof json.title === "string") ? json.title : dataFile;
        if (els.quizTitle) els.quizTitle.textContent = "";

        // Always rebuild QUESTIONS from the *current* quiz JSON so edits (like level changes)
        // reflect immediately even if localStorage has older saved state.
        QUESTIONS = normalizeQuestions(json?.questions);

        const st = loadState(dataFile);
        if (st) {
          idx = Math.max(0, Math.min(st.idx, QUESTIONS.length - 1));
          selectedLevel = (typeof st.selectedLevel === "number") ? st.selectedLevel : null;
          activePlayer = (typeof st.activePlayer === "number") ? Math.max(0, Math.min(3, st.activePlayer)) : 0;
          playerScores[0] = st.playerScores[0] ?? 0;
          playerScores[1] = st.playerScores[1] ?? 0;
          playerScores[2] = st.playerScores[2] ?? 0;
          playerScores[3] = st.playerScores[3] ?? 0;
          if (Array.isArray(st.playerPicks) && st.playerPicks.length === 4) {
            playerPicks = st.playerPicks.map(v => (typeof v === "number" ? v : null));
          }
          stage = (st.stage === "choices" || st.stage === "revealed" || st.stage === "question") ? st.stage : "question";
        }

        if (!QUESTIONS.length) {
          showOverlay("No questions", "The JSON file loaded but contains no valid questions. Expected: { questions: [ { question, options[4], answer_index } ] }.");
          els.questionText.textContent = "No questions found.";
          return;
        }

        if (selectedLevel && (selectedLevel < 1 || selectedLevel > 3)) selectedLevel = null;
        rebuildLevelIndices();
        if (selectedLevel) {
          if (!levelIndices.length) {
            selectedLevel = null;
            rebuildLevelIndices();
          } else if (!levelIndices.includes(idx)) {
            idx = levelIndices[0];
          }
        }

        renderLevelRow();

        // Render
        setScoresVisible(false);
        setEndedUi(false);
        renderQuestion();
        if (els.gameRoot && !els.gameRoot.classList.contains("show")) {
          if (els.btnStart) els.btnStart.focus();
        }
        // Restore stage visibility if we have saved state
        if (st) {
          if (stage === "choices" || stage === "revealed") {
            els.answers.classList.remove("concealed");
            els.players.classList.remove("concealed");
            els.btnShowChoices.disabled = true;
            els.btnShowAnswer.disabled = stage !== "choices";
            renderPlayers();
          }
        }
        if (stage === "revealed") {
          // Re-apply reveal highlight without re-scoring
          revealed = true;
          scoredThisQuestion = true;
          const q = QUESTIONS[idx];
          const cards = Array.from(els.answers.querySelectorAll(".ans"));
          cards.forEach((c) => c.classList.remove("ansWrong", "ansCorrect"));
          cards[q.answer_index]?.classList.add("ansCorrect");
          cards.forEach((c) => c.setAttribute("aria-disabled", "true"));
          els.btnNext.disabled = false;
        }
        setTop();
        saveState(dataFile);
      } catch (err) {
        if (els.quizTitle) els.quizTitle.textContent = dataFile;
        els.questionText.textContent = "Could not load quiz data.";
        showOverlay(
          "Cannot load JSON",
          `Could not load ${dataFile}. If you opened this file directly, your browser may block JSON loading. Run a local server (e.g. python3 -m http.server 8000).\n\nError: ${String(err)}`
        );
      }
    }

    loadQuiz();
  </script>
</body>
</html>
